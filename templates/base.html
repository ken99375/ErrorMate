    <!doctype html>
    <html lang="ja" data-bs-theme="auto">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>{% block title %}ErrorMate{% endblock %}</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- 共通CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!--ファビコン配置-->
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">    

    {% block extra_css %}{% endblock %}
    </head>
    <body>
    {% block header %}
    <!-- 共通ヘッダー -->
    <header class="navbar navbar-light shadow-sm px-3 position-relative {{ g.header_class or header_theme or 'header-default' }}">
    <a href="{{ url_for('main.index') }}"
    class="navbar-brand">
    <img src="{{ url_for('static', filename='images/ErrorMateLogo.png') }}"
        alt="ErrorMate ロゴ"
        width="150"
        height="40"
        margin-left="20";>
    </a>

        {# ここを追加（ユーザー名表示 / ログイン状態で切替） #}
        {% if current_user.is_authenticated %}
        <div class="header-user d-flex align-items-center ms-auto">
            <span class="me-2">ようこそ、{{ current_user.user_name }}</span>
            <a href="{{ url_for('auth.logout') }}" class="btn btn-sm btn-outline-secondary">ログアウト</a>
        </div>
        {% else %}
        <div class="header-auth ms-auto">
            <a href="{{ url_for('auth.login') }}" class="btn btn-sm btn-outline-primary me-2">ログイン</a>
        </div>
        {% endif %}

        <!-- ハンバーガーメニュー -->
        <div class="hamburger-menu" id="customMenu">
        <div class="line"></div>
        <div class="line"></div>
        <div class="line"></div>
        </div>
        
        {% if current_user.role == 'student' %}
        <!-- オーバーレイとメニュー -->
        <div class="overlay"></div>
        <nav class="nav-menu">
        <div class="menu-section">
            <span class="menu-title">ステップカード一覧</span>
            <a href="{{ url_for('step_card.list_cards') }}">・一覧表示</a>
            {# そのうち新規作成用のルート作ったらここを差し替える #}
            {# step_card.create_cardはstep_card.pyに作成しているからそこで引っ張ってくる #}
            <a href="{{ url_for('step_card.create_card') }}">・新規作成</a>
        </div>

        <div class="menu-section">
            <span class="menu-title">ヘルプ要求カード</span>
            <a href="{{ url_for('help.create_help_card') }}">・新規作成</a>
        </div>

        <div class="menu-section">
            <span class="menu-title">カードライブラリ</span>
            <a href="{{ url_for('share.share_step_card_list') }}">・ステップカード</a>
            <a href="{{ url_for('share.share_help_card_list') }}">・ヘルプ要求カード</a>
        </div>

        <div class="menu-section">
            <span class="menu-title">個人分析</span>
            <a href="{{ url_for('personal.data_error_count') }}">・エラー発生回数</a>
            <a href="{{ url_for('personal.language_ratio_page') }}">・言語種別比率</a>
            <a href="{{ url_for('personal.data_error_type_ratio') }}">・エラー種別比率</a>
            <a href="{{ url_for('personal.data_comment_count') }}">・コメント回数</a>
            <a href="{{ url_for('personal.data_comment_trend') }}">・コメント傾向</a>
        </div>
        </nav>
        
        {% elif current_user.role == 'teacher' %}
        <div class="overlay"></div>
        <nav class="nav-menu">
        <div class="menu-section">
            <span class="menu-title">カードライブラリ</span>
            <a href="{{ url_for('share.share_step_card_list') }}">・ステップカード</a>
            <a href="{{ url_for('share.share_help_card_list') }}">・ヘルプ要求カード</a>
        </div>
        <div class="menu-section">
            <span class="menu-title">全体分析</span>
            <a href="#">・総エラー発生回数</a>
            <a href="#">・エラー種別分布</a>
            <a href="#">・コメント総数</a>
        </div>
        </nav>
        {% endif %}
        
    </header>
    {% endblock header %}

    <!-- 各画面ごとの中身 -->
    <main class="container py-5">
        {% block content %}{% endblock %}
    </main>

    <!--ここにフッター作ろ-->
    <footer class="bg-secondary text-light text-center py-3 mt-5 border-top">
        <p class="small mb-0">&copy; 2025 ErrorMate. All rights reserved.</p>
    </footer>

    <!-- 共通JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>

    {% block extra_js %}{% endblock %}
    </body>
    </html>
