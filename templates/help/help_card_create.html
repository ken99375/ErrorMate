{% extends "base.html" %}

{% block title %}ヘルプカード新規作成 - ErrorMate{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
{% endblock %}

{% block content %}
<div class="container_help">

  <form action="{{ url_for('help.create_help_card') }}" method="POST">

    <h2>エラータイトル</h2>
    <input type="text" class="input-box" name="title"
           placeholder="エラータイトルを入力"
           value="{{ form_data.title if form_data else '' }}">

    {% if errors.title %}
      <p class="error">{{ errors.title }}</p>
    {% endif %}

    <h2>エラーコード</h2>
    <input type="text" class="input-box" name="code" id="code"
           placeholder="エラーコードを入力"
           value="{{ form_data.code if form_data else '' }}">

    {% if errors.code %}
      <p class="error">{{ errors.code }}</p>
    {% endif %}

    <h2>エラーメッセージ</h2>
    <textarea class="message-box" name="message" id="message"
              placeholder="エラーメッセージを入力">{{ form_data.message if form_data else '' }}</textarea>

    {% if errors.message %}
      <p class="error">{{ errors.message }}</p>
    {% endif %}

    <div class="tag-section">
      <div id="tagList" class="tag-list"></div>

      <div class="tag-input-row" style="display:flex; align-items:center; gap:.5rem; margin-top:.5rem;">
        <label for="tagText" class="tag-label" style="font-weight:600;">#タグ</label>
        <input id="tagText" type="text" class="tag-input" placeholder="例: python, NameError" />
        <button type="button" id="tagAdd" class="tag-add-btn">＋</button>
      </div>

      <input
          type="hidden"
          id="tagsHidden"
          name="tags"
          value="{{ form_data.tags|join(',') if form_data and form_data.tags else '' }}"
      >
      
      {% if errors.tags %}
        <p class="error">{{ errors.tags }}</p>
      {% endif %}
    </div>
    <button type="button" id="ai-tag-btn" class="btn btn-secondary" style="margin-top: 10px;">
        AIでタグ生成
    </button>
    <p id="tag-status" style="color: #666;"></p>

    <div class="destination-section">
        <label>投稿先選択</label>
        <label><input type="radio" name="target" value="teacher"> 教師</label>
        <label><input type="radio" name="target" value="student"> 学生</label>
    </div>

    <div class="button-section">
      <a href="{{ url_for('main.index') }}" class="back-link">メニューに戻る</a>
      <button type="submit" class="submit-btn">投稿</button>
    </div>

  </form>
</div>

<script src="{{ url_for('static', filename='js/share_tags.js') }}"></script>

{% endblock %}